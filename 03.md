# 3. Codex IDEで実際の天気データを取得するように改変する（40 min / 100 min）

Manusを利用して作成したアプリの雛形を、GitHub Codespaces上で改変します。  
Manusのフリープランでは利用できるトークン量に限りがあるため、トークン利用制限が比較的緩いAIコーディングエージェント  
`Codex IDE extension（以下、長いのでCodex IDE）`を利用します。  

## 3.1. このセクションの目標

> Manusで実装した雛形をGitHub Codespacesに移植し、Vibe Cordingする準備を整える

- Manusが生成したファイル一式をGitHubのリポジトリにコピーする
- 作成したリポジトリでCodespaceを立ち上げ、Codex IDEを使えるようにする
- 移植したファイルをプログラムから実行し、Manusと同様のアプリが再現されることを確認する

## 3.2. ハンズオン

> [!NOTE]
> ここからは開発の場をManusからGitHubとCodex IDEに移します  
> 上記の通り、Manusのフリープランでは利用できるトークン量に限りがあるためです  
> `Manus`: モバイルアプリをVibe Cordingするための下地・雛形の作成  
> `GitHub`: モバイルアプリのコードの管理  
> `Codex IDE`: モバイルアプリへの機能追加・改修  
> という役割分担をイメージするとわかりやすいと思います
  
> [!WARNING]
> 難易度上がります！注意レベル上げていきましょう！  
> Manusは万人に使える親切な環境（その分お金がかかる）でしたが、ここからは実際に開発する職種の人も利用する環境です  
> 1文字の誤りで動かないことも発生します  
> **書いてある手順を遵守する**、**コピペできるところはコピペする**ということを再度意識しましょう

### 3.2.1. Manusで作成したアプリをGitHubに連携

- Manusの画面右上。GitHubのアイコンが描かれたボタンを押します

> <img src="https://i.gyazo.com/21cd0c840b62c338b387a4877c292017.png" alt="gyazo.png" width="450px" />
>
> 黒丸に白抜きの猫のアイコンが`GitHub`のアイコンです

- 開いたメニューにある`Connect`のボタンを押します

> <img src="https://i.gyazo.com/2602df080f128aaca2163ecce0acd09a.png" alt="gyazo.png" width="450px" />

- さらにダイアログが開くので、`+ Connect`ボタンを押して進みます

> <img src="https://i.gyazo.com/ff808f0d72c2ad469f0426915cf20b41.png" alt="gyazo.png" width="450px" />

- Repositoryを追加して良いか聞かれます。`Add Repositories`ボタンを押して進んでください

> <img src="https://i.gyazo.com/2d8df6120d5cc6d592789d65a3bc9dc6.png" alt="gyazo.png" width="450px" />
>
> ここからGitHubのログイン手続きが進みますので、画面に従って進めてください

- GitHubの画面が別タブで開いて遷移します
- Manusとの接続を設定する画面になります

> **① ハンズオンで初めてGitHubを利用される方**  
> `All repositories`を選んで`save`を押してしまって構いません  
>
> **② GitHubを利用したことある方**  
> 別のrepositoryを作成している場合、`Only select repositories`を選択。Manusにアクセスされても問題ないrepositoryを選んで`save`  
> 他のrepositoryがない場合は`All repositories`を選んで`save`
>
> <img src="https://i.gyazo.com/f55f1a02c6c71a988a19cb87678f66fe.png" alt="gyazo.png" width="450px" />
>
> 何らかのrepositoryをManus側に共有しないと`save`ボタンが押せません

- 完了したらManus側のタブに戻ります
- 再度GitHubのアイコンが描かれたボタンを押すと、`Owner`を選択する箇所があるので、ご自身のGitHubアカウント名を選びます
- `Repository name`も変更できます。デフォルトではManusが命名した名前が記載されています

> <img src="https://i.gyazo.com/313f776cbbfb653fea5aa77e40baeaba.png" alt="gyazo.png" width="450px" />

- 選択すると`Create repository`のボタンが押せるようになります
- 押下するとGitHubへの連携作業が開始されます

> <img src="https://i.gyazo.com/3d5239f7dd8ae0d88903c495286a857f.png" alt="gyazo.png" width="450px" />

- 緑色の⚫︎に`Up to date`の文字が表示されていれば成功です

> 赤枠内をクリックしてGitHubに遷移します  
> <img src="https://i.gyazo.com/2225009126c25c300a0651cc899126e8.png" alt="gyazo.png" width="450px" />

- 命名したRepository nameと同じ名前のRepositoryに遷移すれば成功です

> <img src="https://i.gyazo.com/e7a782887713727684aeb25b3236dac4.png" alt="gyazo.png" width="450px" />

#### 3.2.1.1 GitHub Codespacesのタイムアウト時間設定を伸ばす（余力ある人は実施）

スキップしてもOKです。時間余裕ある人は実施しましょう。

GitHub Codespacesはデフォルトだと30分ほどでサスペンド（一時停止）してしまいます。これを回避するためにGitHub Codespacesの設定を変更して2時間（120分）まで延長しておきましょう。最大4時間まで延長できます。

[こちら](https://github.com/settings/codespaces#default-idle-timeout-header)から設定できます。

> 最大だと240分です。
>
> <img src="https://i.gyazo.com/0258599c9954e76fcf000cb23a71d54c.png" alt="gyazo.png" width="450px" />

### 3.2.2. GitHub Codespacesの立ち上げ

ここから実際にVibe Cordingを進める環境の、GitHub Codespaceを立ち上げます

- 緑色の`< > Code ▼`ボタンを押し、続けて`Create codespace on main`を押すとCodespaceが立ち上がります

> <img src="https://i.gyazo.com/f3cf14bd531dae8826c4ba5ddc8b453c.png" alt="gyazo.png" width="450px" />
  
- 空のCodespaceではないので少し時間がかかります

> [!WARNING]
> 立ち上げている間、Codespaceのタブはアクティブな状態（別のタブで隠れていない状態）にしておきましょう（立ち上げが遅くなります）

- 途中、次のような警告が出るかもしれませんが`今後表示しない`を押してしまって構いません

> <img src="https://i.gyazo.com/d958039ea1be83115fdc84c7bf096351.png" alt="gyazo.png" width="450px" />

- 次の画面のような状態になれば成功です

> <img src="https://i.gyazo.com/3ab0626a5f8bd32334e3c9ff89d047f4.png" alt="gyazo.png" width="450px" />

### 3.2.3. Codex IDE のインストールとレイアウト調整

これから利用していくCodex IDEの準備を進めます

#### 3.2.3.1. インストール

- Codespacesの左サイドバーにある◻︎が並んだアイコンをクリックすると`拡張機能`のタブが開きます

> <img src="https://i.gyazo.com/41e3ae51aa421e5c3e7c7d96973f6c4f.png" alt="gyazo.png" width="450px" />

- 入力欄に`Codex`と打ち込むと、`OpenAI`のロゴが描かれた拡張機能がヒットします
- `インストール`ボタンを押してください

> <img src="https://i.gyazo.com/f529af8c532584b1754765a88f563dc7.png" alt="gyazo.png" width="450px" />

- サイドバーにOpenAIのロゴが現れるのでクリックします

> <img src="https://i.gyazo.com/8531a1e485099ca938dfa4cbf1cc7140.png" alt="gyazo.png" width="450px" />

- Codexと書かれた左側のタブが開けばインストール成功です

> <img src="https://i.gyazo.com/0f0fe3b3b0bcba0b49f97ea14a35152b.png" alt="gyazo.png" width="450px" />

#### 3.2.3.2. レイアウト調整

次にレイアウトを調整します。このCodexのパネルは右側に持ってきた方が見やすく、一般的なAIエージェントもこのレイアウトになることが多いので移動させておきましょう。見た目と操作感の問題なのでここの手順が上手くいかなくても問題ありません。

"ChatGPTマーク"を右クリックしてメニューを開く => `移動先` => `セカンダリサイドバー`を選択するとレイアウトを変えられます。

> <img src="https://i.gyazo.com/4843a78183e9296bd3a57513dd2ca9ec.png" alt="gyazo.png" width="450px" />

以下のようなレイアウトになれば成功です。

> <img src="https://i.gyazo.com/22eca0f48a89d7b492491bef14edc355.png" alt="gyazo.png" width="450px" />
> Codexの領域が右側になった状態

### 3.2.4. Codex　IDEのログインと設定の確認

#### 3.2.4.1. APIキーでログイン（tbd）

基本的には有償ツールなのでそのままでは利用できません。Codexにログインをします。

Codexは"ProやPlusプランのChatGPTのアカウント"もしくは"APIキー"を使うことでログインできます。

ここでは運営側で用意したAPIキー（従量課金）を皆さんに付与して利用してもらいます。
Codexが自動運転車だとしてガソリン供給ですね。
今回は事務局で用意しているAPIはOpenAI公式のものを用意しています。

※APIが何か？はそこまで言及しませんが気になる人はChatGPTなどの生成AIに聞いてみましょう。

- `Use API Key`を選択します

> <img src="https://i.gyazo.com/fca5c6fda0ca41b577fbbe08b6d5a485.png" alt="gyazo.png" width="450px" />

次に↓のAPIキーをコピーしてフォームに入力し、OKで進みます。

`sk~~`から始まる文字列をコピーしましょう。

```sh
tbd
```

貼り付け時に次のようなアラートが出たら許可するを押して下さい。

> <img src="https://i.gyazo.com/a5138d630a9564a6a1242c73198c8cb3.png" alt="gyazo.png" width="450px" />

APIキーを貼り付けて`OK`で進みます。

> <img src="https://i.gyazo.com/55e0de563720f8d6e876a41a6676dd34.png" alt="gyazo.png" width="450px" />

次に案内がでますが、`Continue`で進みます。

> <img src="https://i.gyazo.com/fe7990836233cc31d4a655a6f431905b.png" alt="gyazo.png" width="450px" />

このような表示となり、チャットできるようになればOKです。

> <img src="https://i.gyazo.com/f644f5efea20ef516a76bd07c97d8e47.png" alt="gyazo.png" width="450px" />

#### 3.2.4.2. API設定の確認

正しくAPIキーが設定出来ているかまず確認します。

- Chat/Agentのモード、モデル、推論の切り替え

Codexではモード（後述）を切り替えてAIと会話をします。
まずはモードを`Chat`にし、モデルを`codex`が付く中で最も数字が大きいもの、推論は`low`を選択しましょう。

> **モード**  
> <img src="https://i.gyazo.com/7475a3a570af8a9ab5fde669f1dd9ca8.png" alt="gyazo.png" width="450px" />
>
> **モデル**  
> `codex`と書かれているものがVibe Cordingに使われるモデルです  
> 今回はその中でもバージョンが一番新しい`5.2`を選択します  
> <img src="https://i.gyazo.com/37723c98bbec8746fc19315fbcbca6da.png" alt="gyazo.png" width="450px" />
>
> 推論  
> <img src="https://i.gyazo.com/752513e9f6e39466e16b9e2133b12576.png" alt="gyazo.png" width="450px" />

次にチャット欄に`hi`や`こんにちは`など挨拶をして返事があるか確認してください。

> <img src="https://i.gyazo.com/a418decbe8fbc977a295b3891e2d29f7.gif" alt="gyazo.png" width="450px" />

"Hello!~~"など何かしらの返事があればOKです。正常に動いています。

### 3.2.5. Vibe Cording前の準備

#### 3.2.5.1. 画面の説明（説明のみ）

Vibe Cordingを進める前に画面の各エリアの説明です。

> <img src="https://i.gyazo.com/c0d352200289ee8cb899b37e1c796ccb.png" alt="gyazo.png" width="450px" />

- エクスプローラー（赤枠）: ファイルの一覧が表示されます。ここに作成したプログラムやフォルダが表示されます
- エディタ（黄色枠）: ファイルの編集を行う画面です。今回はおそらく自身では触りませんがプログラムの編集過程が表示されます
- Codex（オレンジ枠）: AIと会話をするエリアです。今回のメイン作業（AIとの会話）エリアです
- **ターミナル（紫枠）**: コマンドを実行するエリアです。多少作業が発生します。 **次の章で利用**

各エリアをクリックして操作するエリアを切り替えられます。

#### 3.2.5.2. Codespacesの確認とターミナルの練習

- 立ち上げたCodespaceの状態を確認します
- ターミナル操作の練習をかねて、次のコマンドを**それぞれ**ターミナルに貼り付けて実行してみましょう

> **コマンド1つ目**

```sh
which pnpm
```

- `/home/codespace/nvm/current/bin/pnpm`と表示されれば成功

> **コマンド2つ目**

```sh
pnpm --version
```

- `9.12.0`のような数字が出れば成功（実行した時期によって数字は異なります）

> [!WARNING]
> もし`bash: pnpm: command not found`のようなメッセージが出てしまった場合、**コピペミスなどないか確認**  
> それでも間違っていない場合、事務局まで連絡してください

> **コマンド3つ目**

```sh
pmpm dev:metro
```

- このコマンドを入力すると、先ほどまでのように文字や数字が表示されて終わりとはなりません
- 下記画像のように処理が走り、プログラムが実行され続けた状態になります

> ターミナルを広く上まで表示している状態  
> <img src="https://i.gyazo.com/83d99ceec634e85eb2ad819196fb40d7.png" alt="gyazo.png" width="450px" />
> この二次元バーコードは読み込んでも何も起きません  

- 右下のダイアログに表示されている`ブラウザーで開く`ボタンを押すと、別のタブが開きます
- 誤って消してしまった場合は、ターミナル上部にある`ポート`のタブを開き`8081`番の地球儀マークをクリックすることでも開けます

> 地球儀マークは`転送されたアドレス`列の上にマウスをのせると表示されます  
> <img src="https://i.gyazo.com/b4df50ad7da4af46db619c1ef4b12c84.png" alt="gyazo.png" width="450px" />

- 開くとManus上で表示されたものとほぼ同じアプリが表示されます

> <img src="https://i.gyazo.com/7de1967818ea70d60406179d4f87e8aa.png" alt="gyazo.png" width="450px" />

- せっかくですので、スマートフォンの幅で表示してみましょう
- ブラウザをクリックしてキーボードの`F12`、または**右クリックして`検証`**をクリックすると開発者モードというタブが開きます

> 矢印のタブレットアイコンをクリックし、分割項目をお好きなスマートフォンに合わせると、見た目が再現されます  
> <img src="https://i.gyazo.com/2dd8f47ad9de157e775281870e62c228.png" alt="gyazo.png" width="450px" />

- ここまで成功していれば、Vibe Cordingの準備は万端です。お疲れ様でした

#### 3.2.5.3. ターミナルで実行しているプログラムの停止

最後に実行しているプログラムを停止しましょう。  
ターミナルで実行しているプログラムは、キーボードの`ctrl` + `c`で停止できます。

> 赤枠の中、ターミナル上をクリックしてから、`ctrl` + `c`を押します  
> windowsとmacではcontrolの役割が若干異なりますが、両OSともに`ctrl` + `c`で停止します  
> <img src="https://i.gyazo.com/03706c7d41a2b0bb44afcd0b3930f91b.png" alt="gyazo.png" width="450px" />

- 新規にコマンドを受け付けられる状態になれば成功です

> <img src="https://i.gyazo.com/92b061d71dd916e7aa1082fd8f21e9cf.png" alt="gyazo.png" width="450px" />

## 3.3. Tips

### 3.3.1. pnpmとは?（結構難し目で興味ある方向け）

後半のコマンド入力で何度も出てきた`pnpm`。
これは、package manager（パッケージマネージャ）と呼ばれる道具の一種です。

#### package manager?

非常に端的にいうと、**「アプリ開発に必要な“部品”をまとめて管理してくれる道具」**です。  
実際にアプリ開発をする場面でも、0からプログラムを書き始めることはなく、第三者がまとめてくれた便利な道具（ライブラリやフレームワークと呼ばれます）を利用します。  
その第三者が作った道具を開発環境に持ってきたり、一度作ったアプリを設計書に従って必要な道具を持ってきたりしてくれるのがpackage managerであり、pnpmもその一種です。

#### ハンズオン中に何を実施していたのか？

> `which pnpm`  
>
> - whichは場所を聞くコマンド。すなわちpnpmがどこにあるかを確認しました。  
> - pnpmがCodespaceに入っていないとこの先の開発ができないため、ちゃんと入っていることを確認したのです。

> `pnpm --version`  
>
> - 多くの場合、`--version`でバージョンを確認できます。  
> - pnpmが入っていることは確認しましたが、念のため古すぎないか確認しました。

> `pmpm dev:metro`  
>
> - 実はアプリの設計書にpnpmから`dev:metro`というコマンドを実行すると、ブラウザから確認できることが書いてあるのでそれを実行しました。

#### 設計書はどこにあるのか？

何度か出てきた設計書という表現、今回のアプリでは`package.json`というファイルに記述してあります。

- [package.jsonのサンプル](./samples/sample_package.json)

例としてはこのような感じ（実際にManusが作成したpackage.json）。  
どのような意味を持つのか、そもそもJSONとは何かなど、気になることは生成AIに聞いてみるとさらに学びになります。  
ぜひお時間がある時に実施してみましょう。

## 3.4. 本セッションのまとめ

本セッションでは、`Manusで作成した雛形をGitHub Codespacesに移植`し、`Codespaces上でCodex CLIを利用してVibe Cordingするための準備`を行いました。Manusで作成したテンプレートを利用して、ここからはManusのトークン制限に縛られずに自由に開発ができます（Codexの従量課金は発生しますが）。

なれない操作が多く混乱する部分もあったかもしれませんが、2〜3回繰り返せば慣れてきますし、初回のみ発生する作業もありますので、次回以降はよりスムーズに実行できるでしょう。

また、ある程度手順が頭に入った段階で、裏側ではどのような処理が行われているかを生成AIなどに聞くことでより理解が深まります。お時間のある時に実施してみてください

---

このページの内容は以上です。  
[次ページ](04.md)  
[◀ 目次ページ](./readme.md)
