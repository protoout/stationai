# 3. Codex IDEで実際の天気データを取得するように改変する（40 min / 100 min）

Manusを利用して作成したアプリの雛形を、GitHub Codespaces上で改変します。  
Manusのフリープランでは利用できるトークン量に限りがあるため、トークン利用制限が比較的緩いAIコーディングエージェント  
`Codex IDE extension（以下、長いのでCodex IDE）`を利用します。  

## 3.1. このセクションの目標・期待される結果

> 実際の天気データを反映した天気予報アプリの実装

- Codex IDEでアプリを改変。実際の天気データを取得するアプリが実装できる
- GitHub Codespacesから二次元バーコードを発行し、Expo Goで動かすことができる

## 3.2. ハンズオン

> [!NOTE]
> ここからは開発の場をManusからGitHubとCodex IDEに移します  
> 上記の通り、Manusのフリープランでは利用できるトークン量に限りがあるためです  
> `Manus`: モバイルアプリをVibe Cordingするための下地・雛形の作成  
> `GitHub`: モバイルアプリのコードの管理  
> `Codex IDE`: モバイルアプリへの機能追加・改修  
> という役割分担をイメージするとわかりやすいと思います
---
> [!WARNING]
> 難易度上がります！注意レベル上げていきましょう！  
> Manusは万人に使える親切な環境（その分お金がかかる）でしたが、ここからは実際に開発する職種の人も利用する環境です  
> 1文字の誤りで動かないことも発生します  
> **書いてある手順を遵守する**、**コピペできるところはコピペする**ということを再度意識しましょう

### 3.2.1. Manusで作成したアプリをGitHubに連携

- Manusの画面右上。GitHubのアイコンが描かれたボタンを押します

> <img src="https://i.gyazo.com/21cd0c840b62c338b387a4877c292017.png" alt="gyazo.png" width="450px" />
>
> 黒丸に白抜きの猫のアイコンが`GitHub`のアイコンです

- 開いたメニューにある`Connect`のボタンを押します

> <img src="https://i.gyazo.com/2602df080f128aaca2163ecce0acd09a.png" alt="gyazo.png" width="450px" />

- さらにダイアログが開くので、`+ Connect`ボタンを押して進みます

> <img src="https://i.gyazo.com/ff808f0d72c2ad469f0426915cf20b41.png" alt="gyazo.png" width="450px" />

- Repositoryを追加して良いか聞かれます。`Add Repositories`ボタンを押して進んでください

> <img src="https://i.gyazo.com/2d8df6120d5cc6d592789d65a3bc9dc6.png" alt="gyazo.png" width="450px" />
>
> ここからGitHubのログイン手続きが進みますので、画面に従って進めてください

- GitHubの画面が別タブで開いて遷移します
- Manusとの接続を設定する画面になります

> **① ハンズオンで初めてGitHubを利用される方**  
> `All repositories`を選んで`save`を押してしまって構いません  
>
> **② GitHubを利用したことある方**  
> 別のrepositoryを作成している場合、`Only select repositories`を選択。Manusにアクセスされても問題ないrepositoryを選んで`save`  
> 他のrepositoryがない場合は`All repositories`を選んで`save`
>
> <img src="https://i.gyazo.com/f55f1a02c6c71a988a19cb87678f66fe.png" alt="gyazo.png" width="450px" />
>
> 何らかのrepositoryをManus側に共有しないと`save`ボタンが押せません

- 完了したらManus側のタブに戻ります
- 再度GitHubのアイコンが描かれたボタンを押すと、`Owner`を選択する箇所があるので、ご自身のGitHubアカウント名を選びます
- `Repository name`も変更できます。デフォルトではManusが命名した名前が記載されています

> <img src="https://i.gyazo.com/313f776cbbfb653fea5aa77e40baeaba.png" alt="gyazo.png" width="450px" />

- 選択すると`Create repository`のボタンが押せるようになります
- 押下するとGitHubへの連携作業が開始されます

> <img src="https://i.gyazo.com/3d5239f7dd8ae0d88903c495286a857f.png" alt="gyazo.png" width="450px" />

- 緑色の⚫︎に`Up to date`の文字が表示されていれば成功です

> 赤枠内をクリックしてGitHubに遷移します  
> <img src="https://i.gyazo.com/2225009126c25c300a0651cc899126e8.png" alt="gyazo.png" width="450px" />

- 命名したRepository nameと同じ名前のRepositoryに遷移すれば成功です

> <img src="https://i.gyazo.com/e7a782887713727684aeb25b3236dac4.png" alt="gyazo.png" width="450px" />

#### 3.2.1.1 GitHub Codespacesのタイムアウト時間設定を伸ばす（余力ある人は実施）

スキップしてもOKです。時間余裕ある人は実施しましょう。

GitHub Codespacesはデフォルトだと30分ほどでサスペンド（一時停止）してしまいます。これを回避するためにGitHub Codespacesの設定を変更して2時間（120分）まで延長しておきましょう。最大4時間まで延長できます。

[こちら](https://github.com/settings/codespaces#default-idle-timeout-header)から設定できます。

> 最大だと240分です。
>
> <img src="https://i.gyazo.com/0258599c9954e76fcf000cb23a71d54c.png" alt="gyazo.png" width="450px" />

### 3.2.2. GitHub Codespacesの立ち上げ

ここから実際にVibe Cordingを進める環境の、GitHub Codespaceを立ち上げます

- 緑色の`< > Code ▼`ボタンを押し、続けて`Create codespace on main`を押すとCodespaceが立ち上がります

> <img src="https://i.gyazo.com/f3cf14bd531dae8826c4ba5ddc8b453c.png" alt="gyazo.png" width="450px" />
  
- 空のCodespaceではないので少し時間がかかります

> [!WARNING]
> 立ち上げている間、Codespaceのタブはアクティブな状態（別のタブで隠れていない状態）にしておきましょう（立ち上げが遅くなります）

- 途中、次のような警告が出るかもしれませんが`今後表示しない`を押してしまって構いません

> <img src="https://i.gyazo.com/d958039ea1be83115fdc84c7bf096351.png" alt="gyazo.png" width="450px" />

- 次の画面のような状態になれば成功です

> <img src="https://i.gyazo.com/3ab0626a5f8bd32334e3c9ff89d047f4.png" alt="gyazo.png" width="450px" />

### 3.2.3. Codex IDE のインストールとレイアウト調整

これから利用していくCodex IDEの準備を進めます

#### 3.2.3.1. インストール

- Codespacesの左サイドバーにある◻︎が並んだアイコンをクリックすると`拡張機能`のタブが開きます

> <img src="https://i.gyazo.com/41e3ae51aa421e5c3e7c7d96973f6c4f.png" alt="gyazo.png" width="450px" />

- 入力欄に`Codex`と打ち込むと、`OpenAI`のロゴが描かれた拡張機能がヒットします
- `インストール`ボタンを押してください

> <img src="https://i.gyazo.com/f529af8c532584b1754765a88f563dc7.png" alt="gyazo.png" width="450px" />

- サイドバーにOpenAIのロゴが現れるのでクリックします

> <img src="https://i.gyazo.com/8531a1e485099ca938dfa4cbf1cc7140.png" alt="gyazo.png" width="450px" />

- Codexと書かれた左側のタブが開けばインストール成功です

> <img src="https://i.gyazo.com/0f0fe3b3b0bcba0b49f97ea14a35152b.png" alt="gyazo.png" width="450px" />

#### 3.2.3.2. レイアウト調整

次にレイアウトを調整します。このCodexのパネルは右側に持ってきた方が見やすく、一般的なAIエージェントもこのレイアウトになることが多いので移動させておきましょう。見た目と操作感の問題なのでここの手順が上手くいかなくても問題ありません。

"ChatGPTマーク"を右クリックしてメニューを開く => `移動先` => `セカンダリサイドバー`を選択するとレイアウトを変えられます。

> <img src="https://i.gyazo.com/4843a78183e9296bd3a57513dd2ca9ec.png" alt="gyazo.png" width="450px" />

以下のようなレイアウトになれば成功です。

> <img src="https://i.gyazo.com/22eca0f48a89d7b492491bef14edc355.png" alt="gyazo.png" width="450px" />
> Codexの領域が右側になった状態

### 3.2.4. Codex　IDEのログインと設定の確認

#### 3.2.4.1. APIキーでログイン（tbd）

基本的には有償ツールなのでそのままでは利用できません。Codexにログインをします。

Codexは"ProやPlusプランのChatGPTのアカウント"もしくは"APIキー"を使うことでログインできます。

ここでは運営側で用意したAPIキー（従量課金）を皆さんに付与して利用してもらいます。
Codexが自動運転車だとしてガソリン供給ですね。
今回は事務局で用意しているAPIはOpenAI公式のものを用意しています。

※APIが何か？はそこまで言及しませんが気になる人はChatGPTなどの生成AIに聞いてみましょう。

- `Use API Key`を選択します

> <img src="https://i.gyazo.com/fca5c6fda0ca41b577fbbe08b6d5a485.png" alt="gyazo.png" width="450px" />

次に↓のAPIキーをコピーしてフォームに入力し、OKで進みます。

`sk~~`から始まる文字列をコピーしましょう。

```sh
tbd
```

貼り付け時に次のようなアラートが出たら許可するを押して下さい。

> <img src="https://i.gyazo.com/a5138d630a9564a6a1242c73198c8cb3.png" alt="gyazo.png" width="450px" />

APIキーを貼り付けて`OK`で進みます。

> <img src="https://i.gyazo.com/55e0de563720f8d6e876a41a6676dd34.png" alt="gyazo.png" width="450px" />

次に案内がでますが、`Continue`で進みます。

> <img src="https://i.gyazo.com/fe7990836233cc31d4a655a6f431905b.png" alt="gyazo.png" width="450px" />

このような表示となり、チャットできるようになればOKです。

> <img src="https://i.gyazo.com/f644f5efea20ef516a76bd07c97d8e47.png" alt="gyazo.png" width="450px" />

#### 3.2.4.2. API設定の確認

正しくAPIキーが設定出来ているかまず確認します。

- Chat/Agentのモード、モデル、推論の切り替え

Codexではモード（後述）を切り替えてAIと会話をします。
まずはモードを`Chat`にし、モデルを`codex`が付く中で最も数字が大きいもの、推論は`low`を選択しましょう。

> **モード**  
> <img src="https://i.gyazo.com/7475a3a570af8a9ab5fde669f1dd9ca8.png" alt="gyazo.png" width="450px" />
>
> **モデル**  
> `codex`と書かれているものがVibe Cordingに使われるモデルです  
> 今回はその中でもバージョンが一番新しい`5.2`を選択します  
> <img src="https://i.gyazo.com/37723c98bbec8746fc19315fbcbca6da.png" alt="gyazo.png" width="450px" />
>
> 推論  
> <img src="https://i.gyazo.com/752513e9f6e39466e16b9e2133b12576.png" alt="gyazo.png" width="450px" />

次にチャット欄に`hi`や`こんにちは`など挨拶をして返事があるか確認してください。

> <img src="https://i.gyazo.com/a418decbe8fbc977a295b3891e2d29f7.gif" alt="gyazo.png" width="450px" />

"Hello!~~"など何かしらの返事があればOKです。正常に動いています。

### 3.2.5. Vibe Cording前の準備

#### 3.2.5.1. 画面の説明（説明のみ）

Vibe Cordingを進める前に画面の各エリアの説明です。

> <img src="https://i.gyazo.com/c0d352200289ee8cb899b37e1c796ccb.png" alt="gyazo.png" width="450px" />

- エクスプローラー（赤枠）: ファイルの一覧が表示されます。ここに作成したプログラムやフォルダが表示されます
- エディタ（黄色枠）: ファイルの編集を行う画面です。今回はおそらく自身では触りませんがプログラムの編集過程が表示されます
- Codex（オレンジ枠）: AIと会話をするエリアです。今回のメイン作業（AIとの会話）エリアです
- **ターミナル（紫枠）**: コマンドを実行するエリアです。多少作業が発生します。 **次の章で利用**

各エリアをクリックして操作するエリアを切り替えられます。

#### 3.2.5.2. Codespacesの確認とターミナルの練習

- 立ち上げたCodespaceの状態を確認します
- ターミナル操作の練習をかねて、次のコマンドを**それぞれ**ターミナルに貼り付けて実行してみましょう

> **コマンド1つ目**

```sh
which pnpm
```

- `/home/codespace/nvm/current/bin/pnpm`と表示されれば成功

> **コマンド2つ目**

```sh
pnpm --version
```

- `9.12.0`のような数字が出れば成功（実行した時期によって数字は異なります）

> [!WARNING]
> もし`bash: pnpm: command not found`のようなメッセージが出てしまった場合、**コピペミスなどないか確認**  
> それでも間違っていない場合、事務局まで連絡してください

### 3.2.6. Vibe Cording｜天気データの取得

#### 3.2.6.1. `Chat`での計画立案

- （todo.mdの更新）

#### 3.2.6.2. `Agent`での実装



### 3.2.7. Expoでの確認

- （npx expo start --tunnel）

#### 練習3. `（ctrl + c）`: サーバー停止

サーバープログラムが起動していると、そのターミナルは次のコマンドが入力できません。

また、**AIがアプリケーションを作成してもサーバーの再起動をしないとアプリケーションが更新されない場合もあります**。

これらを踏まえ、起動したサーバーを一度停止する必要があります。

ターミナルエリアをクリックして選択している状態で、`コントロールキー+C`でサーバーを停止できます。

> コントロールキーとキーボードのCを同時押しです。
>
> <img src="https://i.gyazo.com/7d071f5fac766bd721d4b556dcbf83fc.gif" alt="gyazo.png" width="450px" />

停止するとまたlsなど別のコマンドが入力できます。

再度、`npx expo start --tunnel`コマンドを実行してサーバー起動 => `ctrl`+`c`でサーバー停止を繰り返して操作に慣れましょう。

## 3.3. チャレンジ課題｜選択実装（20 min / 120 min）

* プラス1機能を選択実装
  * 現在地ベースの自動ロケーション検出
  * 地図のUIから表示地点を選択
  * 時間別/日別のグラフ表示
  * その他好きな機能を実装
* PC上での一時確認について（`pnpm dev:metro`で発行されるURLにアクセス）

> [!TIP]
> 更新する範囲を制限する（AIにいきなり大胆に変更させない）

大胆には変更しないようにしましょう

> [!TIP]
> 更新したら必ず確認する

一見正しく実装しているように見えても嘘をつく場合があります

## 3.4. Tips

### 3.4.1. APIと天気API（open_meteo）（TBD）

- 外部からデータを取得する手段としてのAPIの説明
- 生成AIに聞いても出てこない内容
  - リアルタイム性が重要な内容 ← 今回はこれ
  - 世間一般的に知られていない内容

### 3.4.2. pnpm?

今は試せないのでこのタイミングでは紹介だけです。

後半でAIから指示が出るかもしれないコマンドです。
指示があれば実施しないといけないですが...出ないことを祈りつつよく分からなくなったらスタッフを呼びましょう。

- `npm start`: プログラムを起動する際によく利用します。登録されているコマンドを実行します
- `npm init`: プロジェクトの初期化
- `npm install`: 必要なライブラリをインストール
- `cd xxx`: `xxxフォルダ`に移動

## 3.5. 本セッションのまとめ

本セッションではGitHub Codespacesを利用したVibe Cordingを体験してみました。  
また、APIという仕組みを利用してリアルタイムなデータを取得することも実践しました。

---

このページの内容は以上です。  
[次ページ](04.md)  
[◀ 目次ページ](./readme.md)
